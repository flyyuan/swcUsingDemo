{"version":3,"sources":["../../src/spack/index.ts"],"sourcesContent":["import { bundle } from '@swc/core';\nimport { mkdir, writeFile } from 'fs';\nimport { basename, dirname, extname, join, relative } from 'path'\nimport { promisify } from 'util';\n\nimport parseSpackArgs from './options';\n\nconst write = promisify(writeFile);\nconst makeDir = promisify(mkdir);\n\n\n(async () => {\n    const { spackOptions } = await parseSpackArgs(process.argv);\n\n    function isUserDefinedEntry(name: string) {\n        if (typeof spackOptions.entry === 'string') {\n            return spackOptions.entry === name\n        }\n        if (Array.isArray(spackOptions.entry)) {\n            for (const e of spackOptions.entry) {\n                if (e === name) {\n                    return true;\n                }\n            }\n            return false;\n        }\n\n        return name in spackOptions.entry;\n    }\n\n\n    async function build() {\n        const bundleStart = process.hrtime();\n        const output = await bundle(spackOptions);\n        const bundleEnd = process.hrtime(bundleStart);\n        console.info(`Bundling done: ${bundleEnd[0]}s ${bundleEnd[1] / 1000000}ms`);\n\n        const emitStart = process.hrtime();\n        if (spackOptions.output?.path) {\n            await Object.keys(output).map(async (name) => {\n                let fullPath = '';\n                if (isUserDefinedEntry(name)) {\n                    fullPath = join(spackOptions.output.path, spackOptions.output.name.replace('[name]', name));\n                } else {\n                    const ext = extname(name);\n                    const base = basename(name, ext);\n                    const filename = relative(process.cwd(), name);\n                    fullPath = join(spackOptions.output.path, dirname(filename), `${base}.js`)\n                }\n\n                await makeDir(dirname(fullPath), { recursive: true });\n                await write(fullPath, output[name].code, 'utf-8');\n                if (output[name].map) {\n                    await write(`${fullPath}.map`, output[name].map, 'utf-8')\n                }\n            });\n        } else {\n            throw new Error('Cannot print to stdout: not implemented yet')\n        }\n        const emitEnd = process.hrtime(emitStart);\n        console.info(`Done: ${emitEnd[0]}s ${emitEnd[1] / 1000000}ms`);\n\n    }\n\n    // if (cliOptions.watch) {\n    //     throw new Error('watch is not implemented yet')\n    // }\n\n    await build();\n})()"],"names":[],"mappings":";AAAuB,GAAW,CAAX,KAAW;AACD,GAAI,CAAJ,GAAI;AACsB,GAAM,CAAN,KAAM;AACvC,GAAM,CAAN,KAAM;AAEL,GAAW,CAAX,QAAW;;;;;;AAEtC,KAAK,CAAC,KAAK,OAJe,KAAM,YAFC,GAAI;AAOrC,KAAK,CAAC,OAAO,OALa,KAAM,YAFC,GAAI;WAUxB,CAAC;IACV,KAAK,GAAG,YAAY,gBAPG,QAAW,UAOY,OAAO,CAAC,IAAI;aAEjD,kBAAkB,CAAC,IAAY,EAAE,CAAC;QACvC,EAAE,SAAS,YAAY,CAAC,KAAK,MAAK,MAAQ,GAAE,CAAC;mBAClC,YAAY,CAAC,KAAK,KAAK,IAAI;QACtC,CAAC;QACD,EAAE,EAAE,KAAK,CAAC,OAAO,CAAC,YAAY,CAAC,KAAK,GAAG,CAAC;iBAC/B,KAAK,CAAC,CAAC,IAAI,YAAY,CAAC,KAAK,CAAE,CAAC;gBACjC,EAAE,EAAE,CAAC,KAAK,IAAI,EAAE,CAAC;2BACN,IAAI;gBACf,CAAC;YACL,CAAC;mBACM,KAAK;QAChB,CAAC;eAEM,IAAI,IAAI,YAAY,CAAC,KAAK;IACrC,CAAC;mBAGc,KAAK,GAAG,CAAC;YAOhB,GAAmB;QANvB,KAAK,CAAC,WAAW,GAAG,OAAO,CAAC,MAAM;QAClC,KAAK,CAAC,MAAM,aAjCG,KAAW,SAiCE,YAAY;QACxC,KAAK,CAAC,SAAS,GAAG,OAAO,CAAC,MAAM,CAAC,WAAW;QAC5C,OAAO,CAAC,IAAI,EAAE,eAAe,EAAE,SAAS,CAAC,CAAC,EAAE,EAAE,EAAE,SAAS,CAAC,CAAC,IAAI,OAAO,CAAC,EAAE;QAEzE,KAAK,CAAC,SAAS,GAAG,OAAO,CAAC,MAAM;QAChC,EAAE,GAAE,GAAmB,GAAnB,YAAY,CAAC,MAAM,cAAnB,GAAmB,UAAnB,CAAyB,QAAzB,CAAyB,GAAzB,GAAmB,CAAE,IAAI,EAAE,CAAC;kBACtB,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,QAAQ,IAAI,GAAK,CAAC;gBAC3C,GAAG,CAAC,QAAQ;gBACZ,EAAE,EAAE,kBAAkB,CAAC,IAAI,GAAG,CAAC;oBAC3B,QAAQ,OAxC+B,KAAM,OAwC7B,YAAY,CAAC,MAAM,CAAC,IAAI,EAAE,YAAY,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,EAAC,MAAQ,GAAE,IAAI;gBAC7F,CAAC,MAAM,CAAC;oBACJ,KAAK,CAAC,GAAG,OA1C8B,KAAM,UA0CzB,IAAI;oBACxB,KAAK,CAAC,IAAI,OA3C6B,KAAM,WA2CvB,IAAI,EAAE,GAAG;oBAC/B,KAAK,CAAC,QAAQ,OA5CyB,KAAM,WA4CnB,OAAO,CAAC,GAAG,IAAI,IAAI;oBAC7C,QAAQ,OA7C+B,KAAM,OA6C7B,YAAY,CAAC,MAAM,CAAC,IAAI,MA7CD,KAAM,UA6CK,QAAQ,MAAM,IAAI,CAAC,GAAG;gBAC5E,CAAC;sBAEK,OAAO,KAhD8B,KAAM,UAgD3B,QAAQ;oBAAK,SAAS,EAAE,IAAI;;sBAC5C,KAAK,CAAC,QAAQ,EAAE,MAAM,CAAC,IAAI,EAAE,IAAI,GAAE,KAAO;gBAChD,EAAE,EAAE,MAAM,CAAC,IAAI,EAAE,GAAG,EAAE,CAAC;0BACb,KAAK,IAAI,QAAQ,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,EAAE,GAAG,GAAE,KAAO;gBAC5D,CAAC;YACL,CAAC;QACL,CAAC,MAAM,CAAC;YACJ,KAAK,CAAC,GAAG,CAAC,KAAK,EAAC,2CAA6C;QACjE,CAAC;QACD,KAAK,CAAC,OAAO,GAAG,OAAO,CAAC,MAAM,CAAC,SAAS;QACxC,OAAO,CAAC,IAAI,EAAE,MAAM,EAAE,OAAO,CAAC,CAAC,EAAE,EAAE,EAAE,OAAO,CAAC,CAAC,IAAI,OAAO,CAAC,EAAE;IAEhE,CAAC;IAED,EAA0B,AAA1B,wBAA0B;IAC1B,EAAsD,AAAtD,oDAAsD;IACtD,EAAI,AAAJ,EAAI;UAEE,KAAK;AACf,CAAC"}